<mat-card>

  <div class="header">
    <h2>Orders</h2>

    <button mat-raised-button color="primary" (click)="openCreate()">
      + Create Order
    </button>
  </div>

  @if (loading) {
    <div class="loader">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  @if (!loading) {

    <table mat-table [dataSource]="paged" class="mat-elevation-z2">

      <!-- Customer -->
      <ng-container matColumnDef="customer">
        <th mat-header-cell *matHeaderCellDef> Customer </th>
        <td mat-cell *matCellDef="let o"> {{ o.customerName }} </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Status </th>
        <td mat-cell *matCellDef="let o">
          <span class="badge" [ngClass]="o.status.toLowerCase()">
            {{ o.status }}
          </span>
        </td>
      </ng-container>

      <!-- Items -->
      <ng-container matColumnDef="items">
        <th mat-header-cell *matHeaderCellDef> Items </th>
        <td mat-cell *matCellDef="let o">
          {{ o.items.length }} item(s)
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let o">

          <button
            mat-stroked-button
            color="primary"
            (click)="markPaid(o)"
            [disabled]="o.status !== 'CREATED'">
            Pay
          </button>

          <button
            mat-stroked-button
            color="warn"
            (click)="cancel(o)"
            [disabled]="o.status === 'PAID' || o.status === 'CANCELLED'">
            Cancel
          </button>


        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

    <mat-paginator
      [length]="orders.length"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5,10,20]"
      (page)="onPage($event)">
    </mat-paginator>

  }

</mat-card>

<style>
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .loader {
    display: flex;
    justify-content: center;
    margin: 30px 0;
  }

  .badge {
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    text-transform: capitalize;
  }

  .created { background:#e3f2fd; color:#1976d2; }
  .paid    { background:#e8f5e9; color:#2e7d32; }
  .cancelled { background:#ffebee; color:#c62828; }
</style>
